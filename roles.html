<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arca.OS | Configuración de Permisos - Prototipo</title>
    <!-- Google Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="arca-continental-theme.css">
    <style>
        /* Filter Card */
        .filters-card {
            background: var(--color-neutral-0);
            border: 1px solid var(--color-neutral-3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            align-items: end;
        }

        .filter-field {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-field label {
            font-size: 12px;
            font-weight: 600;
            color: var(--color-neutral-6);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-actions {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
        }

        .empty-state-icon {
            width: 120px;
            height: 120px;
            background: var(--color-neutral-2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
        }

        .empty-state-icon .material-symbols-rounded {
            font-size: 56px;
            color: var(--color-neutral-4);
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-neutral-7);
            margin-bottom: 8px;
        }

        .empty-state-text {
            font-size: 14px;
            color: var(--color-neutral-5);
            max-width: 400px;
        }

        /* Permission row */
        .permission-row {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .permission-user {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .permission-user-name {
            font-weight: 600;
            color: var(--color-neutral-9);
        }

        .permission-user-id {
            font-size: 12px;
            color: var(--color-neutral-5);
        }

        /* Role badge */
        .role-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
        }

        .role-badge.admin {
            background: var(--arca-red-light);
            color: var(--arca-red);
        }

        .role-badge.manager {
            background: var(--color-info-light);
            color: var(--color-info);
        }

        .role-badge.developer {
            background: #E8F5E9;
            color: #2E7D32;
        }

        .role-badge.boss {
            background: #FFF3E0;
            color: #E65100;
        }

        .role-badge.default {
            background: var(--color-neutral-2);
            color: var(--color-neutral-7);
        }

        /* User actions */
        .user-actions {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Hierarchy badges */
        .hierarchy-cell {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .hierarchy-main {
            font-weight: 500;
            color: var(--color-neutral-8);
        }

        .hierarchy-sub {
            font-size: 11px;
            color: var(--color-neutral-5);
        }

        /* Stats summary */
        .stats-summary {
            display: flex;
            gap: 24px;
            padding: 16px 20px;
            background: var(--color-neutral-1);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--color-neutral-9);
        }

        .stat-label {
            font-size: 13px;
            color: var(--color-neutral-6);
        }

        /* Form group in modal */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 768px) {
            .filters-grid {
                grid-template-columns: 1fr;
            }

            .filter-actions {
                flex-direction: column;
                width: 100%;
            }

            .filter-actions .btn {
                width: 100%;
                justify-content: center;
            }

            .stats-summary {
                flex-wrap: wrap;
                gap: 16px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .hide-mobile {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar Overlay (Mobile) -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Toggle Button -->
            <button class="sidebar-toggle" id="sidebarToggle" title="Colapsar menú">
                <span class="material-symbols-rounded">chevron_left</span>
            </button>

            <div class="sidebar-header">
                <img src="assets/Arca_continental_logo_simple.png" alt="Arca Continental" class="sidebar-company-logo" />
                <div class="sidebar-brand">
                    <div class="sidebar-logo">
                        <span class="logo-text">ARCA</span>
                        <span class="logo-dot"></span>
                        <span class="logo-text">OS</span>
                    </div>
                    <span class="sidebar-subtitle">OR Equipo frío</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <a href="layout.html" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">dashboard</span></span>
                        <span>Dashboard</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Operación</div>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">assignment</span></span>
                        <span>Órdenes de Recuperación</span>
                        <span class="nav-item-badge">24</span>
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">account_balance</span></span>
                        <span>Contraloría</span>
                        <span class="nav-item-badge">8</span>
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">person_check</span></span>
                        <span>Aprobación Jefe de Ventas</span>
                        <span class="nav-item-badge">5</span>
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">manage_accounts</span></span>
                        <span>Aprobación Gerente de Ventas</span>
                        <span class="nav-item-badge">3</span>
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">location_city</span></span>
                        <span>Aprobación Gerente Regional</span>
                        <span class="nav-item-badge">2</span>
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">corporate_fare</span></span>
                        <span>Aprobación Gerente CH</span>
                        <span class="nav-item-badge">1</span>
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">handshake</span></span>
                        <span>Comodato</span>
                        <span class="nav-item-badge">12</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Auditoría</div>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">bar_chart</span></span>
                        <span>Reportes</span>
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">history</span></span>
                        <span>Bitácora de Acciones</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Datos</div>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">sync</span></span>
                        <span>Sincronizar</span>
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">send</span></span>
                        <span>Enviar Información</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Administración</div>
                    <a href="roles.html" class="nav-item active">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">admin_panel_settings</span></span>
                        <span>Configuración Permisos</span>
                    </a>
                    <a href="catalogos.html" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">category</span></span>
                        <span>Catálogos</span>
                    </a>
                    <a href="recordatorios.html" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">notifications_active</span></span>
                        <span>Recordatorios</span>
                    </a>
                    <a href="usuarios.html" class="nav-item">
                        <span class="nav-item-icon"><span class="material-symbols-rounded">group</span></span>
                        <span>Usuarios</span>
                    </a>
                </div>
            </nav>

        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Header -->
            <header class="top-header">
                <div class="header-left">
                    <button class="mobile-menu-btn" id="mobileMenuBtn"><span class="material-symbols-rounded">menu</span></button>
                    <h1 class="font-size-2xl font-bold text-neutral-9">Configuración de Permisos</h1>
                    <div class="breadcrumb font-size-xs text-neutral-5">
                        <a href="layout.html">Inicio</a> / <a href="#">Administración</a> / Permisos
                    </div>
                </div>

                <div class="header-right">
                    <button class="header-btn" title="Buscar"><span class="material-symbols-rounded">search</span></button>
                    <button class="header-btn" title="Notificaciones">
                        <span class="material-symbols-rounded">notifications</span>
                        <span class="badge">3</span>
                    </button>
                    <button class="header-btn" title="Ayuda"><span class="material-symbols-rounded">help</span></button>
                    <div class="header-divider"></div>
                    <div class="header-user" id="headerUser">
                        <div class="user-chip" onclick="toggleUserDropdown()">
                            <div class="header-avatar">CO</div>
                            <div class="user-chip-info">
                                <span class="font-size-s font-semi-bold text-neutral-9">Carlos Operador</span>
                                <span class="font-size-xxs text-neutral-5">Admin TI</span>
                            </div>
                            <span class="material-symbols-rounded text-neutral-5 icon-size-20">expand_more</span>
                        </div>
                        <div class="user-dropdown">
                            <div class="dropdown-header">
                                <div class="dropdown-user-info">
                                    <div class="dropdown-avatar">CO</div>
                                    <div class="dropdown-user-details">
                                        <div class="dropdown-user-name">Carlos Operador</div>
                                        <div class="dropdown-user-role">Admin TI</div>
                                        <div class="dropdown-user-email">carlos.operador@arcacontal.com</div>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown-menu">
                                <button class="dropdown-item">
                                    <span class="material-symbols-rounded">person</span>
                                    Mi Perfil
                                </button>
                                <button class="dropdown-item">
                                    <span class="material-symbols-rounded">settings</span>
                                    Configuración
                                </button>
                                <div class="dropdown-divider"></div>
                                <button class="dropdown-item logout" onclick="handleLogout()">
                                    <span class="material-symbols-rounded">logout</span>
                                    Cerrar Sesión
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Fixed Header -->
                <div class="content-header-fixed">
                    <h2 class="font-size-2xl font-bold text-neutral-9">Asignación de Permisos por Ubicación</h2>
                    <div class="display-flex gap-s">
                        <button class="btn btn-cancel" onclick="exportData()">
                            <span class="material-symbols-rounded">download</span>
                            <span>Exportar</span>
                        </button>
                        <button class="btn btn-primary" onclick="openAddModal()">
                            <span class="material-symbols-rounded">add</span>
                            <span>Asignar Permiso</span>
                        </button>
                    </div>
                </div>

                <!-- Scrollable Content Card -->
                <div class="content-scroll-card">
                    <!-- Filters Card -->
                    <div class="filters-card">
                        <div class="filters-grid">
                            <div class="filter-field">
                                <label>Usuario</label>
                                <div class="select-wrapper">
                                    <select class="form-select" id="filterUser">
                                        <option value="">Todos los usuarios</option>
                                        <option value="3086">Raul Gonzalez Almora</option>
                                        <option value="3061">Alberto Rafael Ramos Flores</option>
                                        <option value="2913">Juan Ignacio Ochoa Gutierrez</option>
                                        <option value="2845">Maria Elena Torres</option>
                                        <option value="2801">Carlos Martinez Lopez</option>
                                    </select>
                                    <span class="material-symbols-rounded select-icon">expand_more</span>
                                </div>
                            </div>
                            <div class="filter-field">
                                <label>Rol</label>
                                <div class="select-wrapper">
                                    <select class="form-select" id="filterRole">
                                        <option value="">Todos los roles</option>
                                        <option value="CE_Developer">CE_Developer</option>
                                        <option value="CE_SalesManager">CE_SalesManager</option>
                                        <option value="CE_SalesBoss">CE_SalesBoss</option>
                                        <option value="CE_RegionalManager">CE_RegionalManager</option>
                                        <option value="CE_Controller">CE_Controller</option>
                                    </select>
                                    <span class="material-symbols-rounded select-icon">expand_more</span>
                                </div>
                            </div>
                            <div class="filter-field">
                                <label>Centro</label>
                                <div class="select-wrapper">
                                    <select class="form-select" id="filterCentro">
                                        <option value="">Todos los centros</option>
                                        <option value="3005">Lincoln - 3005</option>
                                        <option value="3010">Monterrey Norte - 3010</option>
                                        <option value="3015">Guadalupe - 3015</option>
                                        <option value="3020">San Nicolas - 3020</option>
                                    </select>
                                    <span class="material-symbols-rounded select-icon">expand_more</span>
                                </div>
                            </div>
                            <div class="filter-field">
                                <label>Ruta</label>
                                <div class="select-wrapper">
                                    <select class="form-select" id="filterRuta">
                                        <option value="">Todas las rutas</option>
                                        <option value="705150">705150</option>
                                        <option value="705151">705151</option>
                                        <option value="705152">705152</option>
                                        <option value="705160">705160</option>
                                    </select>
                                    <span class="material-symbols-rounded select-icon">expand_more</span>
                                </div>
                            </div>
                            <div class="filter-actions">
                                <button class="btn btn-primary" onclick="applyFilters()">
                                    <span class="material-symbols-rounded">filter_alt</span>
                                    Filtrar
                                </button>
                                <button class="btn btn-cancel" onclick="clearFilters()" title="Limpiar filtros">
                                    <span class="material-symbols-rounded">refresh</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Summary -->
                    <div class="stats-summary">
                        <div class="stat-item">
                            <span class="stat-value" id="totalAssignments">15</span>
                            <span class="stat-label">Asignaciones</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="totalUsers">8</span>
                            <span class="stat-label">Usuarios</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="totalRoles">5</span>
                            <span class="stat-label">Roles activos</span>
                        </div>
                    </div>

                    <!-- Permissions Table -->
                    <div class="table-container">
                        <table class="data-table" id="permissionsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Usuario</th>
                                    <th>Centro</th>
                                    <th class="hide-mobile">Territorio</th>
                                    <th class="hide-mobile">Región</th>
                                    <th>Ruta</th>
                                    <th>Rol</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="permissionsTableBody">
                                <!-- Content loaded dynamically -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Empty State (hidden by default) -->
                    <div class="empty-state" id="emptyState" style="display: none;">
                        <div class="empty-state-icon">
                            <span class="material-symbols-rounded">search_off</span>
                        </div>
                        <div class="empty-state-title">Sin resultados para mostrar</div>
                        <div class="empty-state-text">No se encontraron asignaciones con los filtros seleccionados. Intenta ajustar los criterios de búsqueda.</div>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination" id="pagination">
                        <div class="pagination-info">
                            <span class="font-size-s text-neutral-6">Mostrando <strong>1-8</strong> de <strong id="totalCount">8</strong> asignaciones</span>
                        </div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled title="Primera página">
                                <span class="material-symbols-rounded">first_page</span>
                            </button>
                            <button class="pagination-btn" disabled title="Anterior">
                                <span class="material-symbols-rounded">chevron_left</span>
                            </button>
                            <div class="pagination-pages">
                                <button class="pagination-page active">1</button>
                                <button class="pagination-page">2</button>
                                <button class="pagination-page">3</button>
                                <span class="pagination-ellipsis">...</span>
                                <button class="pagination-page">10</button>
                            </div>
                            <button class="pagination-btn" title="Siguiente">
                                <span class="material-symbols-rounded">chevron_right</span>
                            </button>
                            <button class="pagination-btn" title="Última página">
                                <span class="material-symbols-rounded">last_page</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Permission Modal -->
    <div class="modal-overlay" id="addModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title">Asignar Nuevo Permiso</h2>
                <button class="modal-close" onclick="closeAddModal()">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Usuario *</label>
                    <div class="select-wrapper">
                        <select class="form-select" id="modalUser">
                            <option value="">Seleccionar usuario...</option>
                            <option value="3086">Raul Gonzalez Almora (3086)</option>
                            <option value="3061">Alberto Rafael Ramos Flores (3061)</option>
                            <option value="2913">Juan Ignacio Ochoa Gutierrez (2913)</option>
                            <option value="2845">Maria Elena Torres (2845)</option>
                            <option value="2801">Carlos Martinez Lopez (2801)</option>
                        </select>
                        <span class="material-symbols-rounded select-icon">expand_more</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Rol *</label>
                    <div class="select-wrapper">
                        <select class="form-select" id="modalRole">
                            <option value="">Seleccionar rol...</option>
                            <option value="CE_Developer">CE_Developer</option>
                            <option value="CE_SalesManager">CE_SalesManager</option>
                            <option value="CE_SalesBoss">CE_SalesBoss</option>
                            <option value="CE_RegionalManager">CE_RegionalManager</option>
                            <option value="CE_Controller">CE_Controller</option>
                        </select>
                        <span class="material-symbols-rounded select-icon">expand_more</span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Centro *</label>
                        <div class="select-wrapper">
                            <select class="form-select" id="modalCentro">
                                <option value="">Seleccionar centro...</option>
                                <option value="3005">Lincoln - 3005</option>
                                <option value="3010">Monterrey Norte - 3010</option>
                                <option value="3015">Guadalupe - 3015</option>
                                <option value="3020">San Nicolas - 3020</option>
                            </select>
                            <span class="material-symbols-rounded select-icon">expand_more</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ruta *</label>
                        <div class="select-wrapper">
                            <select class="form-select" id="modalRuta">
                                <option value="">Seleccionar ruta...</option>
                                <option value="705150">705150</option>
                                <option value="705151">705151</option>
                                <option value="705152">705152</option>
                                <option value="705160">705160</option>
                            </select>
                            <span class="material-symbols-rounded select-icon">expand_more</span>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Territorio</label>
                        <div class="select-wrapper">
                            <select class="form-select" id="modalTerritorio">
                                <option value="">Seleccionar territorio...</option>
                                <option value="monterrey">Monterrey</option>
                                <option value="guadalupe">Guadalupe</option>
                                <option value="sannicolas">San Nicolás</option>
                                <option value="apodaca">Apodaca</option>
                            </select>
                            <span class="material-symbols-rounded select-icon">expand_more</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Región</label>
                        <div class="select-wrapper">
                            <select class="form-select" id="modalRegion">
                                <option value="">Seleccionar región...</option>
                                <option value="noreste">Noreste</option>
                                <option value="norte">Norte</option>
                                <option value="centro">Centro</option>
                                <option value="sur">Sur</option>
                            </select>
                            <span class="material-symbols-rounded select-icon">expand_more</span>
                        </div>
                    </div>
                </div>

                <p class="font-size-xs text-neutral-5 margin-top-s">
                    <span class="material-symbols-rounded icon-size-16" style="vertical-align: middle;">info</span>
                    El usuario tendrá acceso a las operaciones del rol seleccionado dentro del centro y ruta especificados.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeAddModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="savePermission()">
                    <span class="material-symbols-rounded">save</span>
                    Guardar Permiso
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-container modal-sm">
            <div class="modal-header">
                <h2 class="modal-title">Eliminar Permiso</h2>
                <button class="modal-close" onclick="closeDeleteModal()">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="text-neutral-7" style="line-height: 1.6;">
                    ¿Estás seguro de que deseas eliminar el permiso de <strong id="deleteUserName">este usuario</strong>?
                </p>
                <p class="font-size-s text-neutral-5 margin-top-s">
                    El usuario perderá acceso a las operaciones asociadas a este rol en el centro y ruta especificados.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeDeleteModal()">Cancelar</button>
                <button class="btn btn-danger" onclick="confirmDelete()">
                    <span class="material-symbols-rounded">delete</span>
                    Eliminar
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span class="material-symbols-rounded" id="toastIcon">check_circle</span>
        <span id="toastMessage">Cambios guardados exitosamente</span>
    </div>

    <script>
        // Sample Data
        const permissions = [
            { id: 1, odoo_id: '3086', user: 'Raul Gonzalez Almora', centro: '3005', territorio: 'Monterrey', region: 'Noreste', ruta: '705150', role: 'CE_Developer' },
            { id: 2, odoo_id: '3061', user: 'Alberto Rafael Ramos Flores', centro: '3005', territorio: 'Monterrey', region: 'Noreste', ruta: '705150', role: 'CE_SalesBoss' },
            { id: 3, odoo_id: '2913', user: 'Juan Ignacio Ochoa Gutierrez', centro: '3005', territorio: 'Monterrey', region: 'Noreste', ruta: '705150', role: 'CE_SalesManager' },
            { id: 4, odoo_id: '2845', user: 'Maria Elena Torres', centro: '3010', territorio: 'Monterrey', region: 'Noreste', ruta: '705151', role: 'CE_Controller' },
            { id: 5, odoo_id: '2801', user: 'Carlos Martinez Lopez', centro: '3015', territorio: 'Guadalupe', region: 'Noreste', ruta: '705152', role: 'CE_RegionalManager' },
            { id: 6, odoo_id: '3086', user: 'Raul Gonzalez Almora', centro: '3010', territorio: 'Monterrey', region: 'Noreste', ruta: '705151', role: 'CE_SalesManager' },
            { id: 7, odoo_id: '2913', user: 'Juan Ignacio Ochoa Gutierrez', centro: '3015', territorio: 'Guadalupe', region: 'Noreste', ruta: '705152', role: 'CE_Developer' },
            { id: 8, odoo_id: '2845', user: 'Maria Elena Torres', centro: '3005', territorio: 'Monterrey', region: 'Noreste', ruta: '705150', role: 'CE_SalesBoss' },
        ];

        let filteredPermissions = [...permissions];
        let deleteId = null;

        // Role badge classes
        const roleClasses = {
            'CE_Developer': 'developer',
            'CE_SalesManager': 'manager',
            'CE_SalesBoss': 'boss',
            'CE_RegionalManager': 'admin',
            'CE_Controller': 'default'
        };

        // Mobile Menu
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        mobileMenuBtn.addEventListener('click', () => {
            sidebar.classList.toggle('open');
            sidebarOverlay.classList.toggle('active');
        });

        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
        });

        // Sidebar Toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
        });

        // Nav Item Click Handler
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                if (this.getAttribute('href') === '#') {
                    e.preventDefault();
                }
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('active');
            });
        });

        // User Dropdown
        function toggleUserDropdown() {
            const headerUser = document.getElementById('headerUser');
            headerUser.classList.toggle('active');
        }

        document.addEventListener('click', (e) => {
            const headerUser = document.getElementById('headerUser');
            if (!headerUser.contains(e.target)) {
                headerUser.classList.remove('active');
            }
        });

        function handleLogout() {
            window.location.href = 'login.html';
        }

        // Render Table
        function renderTable() {
            const tbody = document.getElementById('permissionsTableBody');
            const emptyState = document.getElementById('emptyState');
            const pagination = document.getElementById('pagination');
            const tableContainer = document.querySelector('.table-container');

            if (filteredPermissions.length === 0) {
                tableContainer.style.display = 'none';
                pagination.style.display = 'none';
                emptyState.style.display = 'flex';
            } else {
                tableContainer.style.display = 'block';
                pagination.style.display = 'flex';
                emptyState.style.display = 'none';

                tbody.innerHTML = filteredPermissions.map(p => `
                    <tr>
                        <td class="font-semi-bold text-neutral-7">${p.odoo_id}</td>
                        <td>
                            <div class="permission-user">
                                <span class="permission-user-name">${p.user}</span>
                            </div>
                        </td>
                        <td class="font-semi-bold text-neutral-8">${p.centro}</td>
                        <td class="hide-mobile text-neutral-7">${p.territorio}</td>
                        <td class="hide-mobile text-neutral-7">${p.region}</td>
                        <td class="font-semi-bold text-neutral-8">${p.ruta}</td>
                        <td>
                            <span class="role-badge ${roleClasses[p.role] || 'default'}">${p.role}</span>
                        </td>
                        <td>
                            <div class="user-actions">
                                <button class="action-btn" title="Eliminar" onclick="deletePermission(${p.id}, '${p.user}')"><span class="material-symbols-rounded">delete</span></button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            // Update counts
            document.getElementById('totalCount').textContent = filteredPermissions.length;
            document.getElementById('totalAssignments').textContent = filteredPermissions.length;
            document.getElementById('totalUsers').textContent = [...new Set(filteredPermissions.map(p => p.odoo_id))].length;
            document.getElementById('totalRoles').textContent = [...new Set(filteredPermissions.map(p => p.role))].length;
        }

        // Filters
        function applyFilters() {
            const user = document.getElementById('filterUser').value;
            const role = document.getElementById('filterRole').value;
            const centro = document.getElementById('filterCentro').value;
            const ruta = document.getElementById('filterRuta').value;

            filteredPermissions = permissions.filter(p => {
                if (user && p.odoo_id !== user) return false;
                if (role && p.role !== role) return false;
                if (centro && p.centro !== centro) return false;
                if (ruta && p.ruta !== ruta) return false;
                return true;
            });

            renderTable();
            showToast('Filtros aplicados', 'success');
        }

        function clearFilters() {
            document.getElementById('filterUser').value = '';
            document.getElementById('filterRole').value = '';
            document.getElementById('filterCentro').value = '';
            document.getElementById('filterRuta').value = '';
            filteredPermissions = [...permissions];
            renderTable();
            showToast('Filtros limpiados', 'success');
        }

        // Modal Functions
        const addModal = document.getElementById('addModal');
        const deleteModal = document.getElementById('deleteModal');

        function openAddModal() {
            document.getElementById('modalUser').value = '';
            document.getElementById('modalRole').value = '';
            document.getElementById('modalCentro').value = '';
            document.getElementById('modalRuta').value = '';
            document.getElementById('modalTerritorio').value = '';
            document.getElementById('modalRegion').value = '';
            addModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeAddModal() {
            addModal.classList.remove('active');
            document.body.style.overflow = '';
        }

        function savePermission() {
            const user = document.getElementById('modalUser').value;
            const role = document.getElementById('modalRole').value;
            const centro = document.getElementById('modalCentro').value;
            const ruta = document.getElementById('modalRuta').value;

            if (!user || !role || !centro || !ruta) {
                showToast('Por favor completa los campos requeridos', 'error');
                return;
            }

            const btn = event.target;
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<span class="material-symbols-rounded spinning">sync</span> Guardando...';
            btn.disabled = true;

            setTimeout(() => {
                // Add new permission
                const userOption = document.getElementById('modalUser').options[document.getElementById('modalUser').selectedIndex];
                const userName = userOption.text.split(' (')[0];
                const territorio = document.getElementById('modalTerritorio').value || 'Monterrey';
                const region = document.getElementById('modalRegion').value || 'Noreste';

                permissions.unshift({
                    id: Math.max(...permissions.map(p => p.id)) + 1,
                    odoo_id: user,
                    user: userName,
                    centro: centro,
                    territorio: territorio.charAt(0).toUpperCase() + territorio.slice(1),
                    region: region.charAt(0).toUpperCase() + region.slice(1),
                    ruta: ruta,
                    role: role
                });

                filteredPermissions = [...permissions];
                renderTable();

                btn.innerHTML = originalHTML;
                btn.disabled = false;
                closeAddModal();
                showToast('Permiso asignado exitosamente', 'success');
            }, 1000);
        }

        function deletePermission(id, userName) {
            deleteId = id;
            document.getElementById('deleteUserName').textContent = userName;
            deleteModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeDeleteModal() {
            deleteModal.classList.remove('active');
            document.body.style.overflow = '';
            deleteId = null;
        }

        function confirmDelete() {
            if (!deleteId) return;

            const btn = event.target;
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<span class="material-symbols-rounded spinning">sync</span> Eliminando...';
            btn.disabled = true;

            setTimeout(() => {
                const index = permissions.findIndex(p => p.id === deleteId);
                if (index > -1) {
                    permissions.splice(index, 1);
                }
                filteredPermissions = filteredPermissions.filter(p => p.id !== deleteId);
                renderTable();

                btn.innerHTML = originalHTML;
                btn.disabled = false;
                closeDeleteModal();
                showToast('Permiso eliminado exitosamente', 'success');
            }, 1000);
        }

        function exportData() {
            showToast('Exportando datos...', 'success');
        }

        // Toast
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');

            toast.className = 'toast ' + type;
            toastMessage.textContent = message;
            toastIcon.textContent = type === 'success' ? 'check_circle' : 'error';
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Close modals on overlay click
        addModal.addEventListener('click', (e) => {
            if (e.target === addModal) closeAddModal();
        });

        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) closeDeleteModal();
        });

        // Close modals on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (addModal.classList.contains('active')) closeAddModal();
                if (deleteModal.classList.contains('active')) closeDeleteModal();
            }
        });

        // Initial render
        renderTable();
    </script>
</body>
</html>
